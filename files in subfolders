Sub ListFilesInFolders()
    Dim folderPath As String
    Dim folderCell As Range
    Dim folderRange As Range
    Dim folder As Object
    Dim subfolder As Object
    Dim file As Object
    Dim row As Long
    
    ' Setze den Dateipfad aus der ersten Zelle des Arbeitsblatts
    folderPath = ActiveSheet.Range("A1").Value
    
    ' Überprüfe, ob der Dateipfad vorhanden ist
    If Dir(folderPath, vbDirectory) = "" Then
        MsgBox "Ungültiger Dateipfad."
        Exit Sub
    End If
    
    ' Lösche den Inhalt des Arbeitsblatts außerhalb der ersten Zelle
    ActiveSheet.UsedRange.Offset(1).Clear
    
    ' Setze die Überschriften für die Spalten
    ActiveSheet.Range("A2:E2").Value = Array("Ordner", "Dateiname", "Dateityp", "Erstellungsdatum", "Änderungsdatum")
    
    ' Setze die Zelle für den Dateipfad
    Set folderCell = ActiveSheet.Range("A1")
    
    ' Setze den Bereich für die Ordner
    Set folderRange = ActiveSheet.Range("A3")
    
    ' Beginne in der vierten Zeile
    row = 4
    
    ' Schleife durch die Unterordner im Dateipfad
    For Each folder In CreateObject("Scripting.FileSystemObject").GetFolder(folderPath).Subfolders
        ' Schreibe den Ordnernamen in die Zelle
        folderRange.Value = folder.Name
        
        ' Schleife durch die Dateien im aktuellen Unterordner
        For Each file In folder.Files
            ' Schreibe die Dateiinformationen in die entsprechenden Spalten
            ActiveSheet.Cells(row, 2).Value = file.Name
            ActiveSheet.Cells(row, 3).Value = file.Type
            ActiveSheet.Cells(row, 4).Value = file.DateCreated
            ActiveSheet.Cells(row, 5).Value = file.DateLastModified
            ActiveSheet.Cells(row, 1).Value = folder.Name ' Neue Spalte für Ordner hinzugefügt
            row = row + 1
        Next file
        
        ' Verschiebe den Bereich für die Ordner um eine Zeile nach unten
        Set folderRange = folderRange.Offset(1)
    Next folder
    
    ' Autofit Spaltenbreite
    ActiveSheet.UsedRange.Columns.AutoFit
    
    MsgBox "Die Dateien wurden erfolgreich aufgelistet."
End Sub
